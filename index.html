<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner QR Code</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        #qr-video {
            width: 100%;
            max-width: 400px;
            transform: scaleX(-1); /* Inverser la vidéo pour obtenir une vue miroir */
        }
    </style>
</head>
<body>
    <video id="qr-video" playsinline></video>

    <script>
        // Fonction pour initialiser le scanner de QR code
        function initQRCodeScanner() {
            const video = document.getElementById('qr-video');

            // Vérifier si le navigateur prend en charge l'API getUserMedia
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                    .then((stream) => {
                        // Afficher la vidéo de la caméra dans l'élément video
                        video.srcObject = stream;

                        // Lorsque la vidéo est chargée, démarrer le scanner QR code
                        video.onloadedmetadata = () => {
                            video.play();
                            startQRCodeScanner(video);
                        };
                    })
                    .catch((error) => {
                        console.error('Erreur lors de l\'accès à la caméra: ', error);
                    });
            } else {
                alert('Votre navigateur ne prend pas en charge l\'API getUserMedia.');
            }
        }

        // Fonction pour démarrer le scanner QR code
        function startQRCodeScanner(video) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');

            // Définir la taille du canvas en fonction de la vidéo
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const qrWorker = new Worker('jsQR.js'); // Chargement du worker jsQR

            qrWorker.onmessage = (event) => {
                if (event.data) {
                    alert('QR Code scanné. Contenu: ' + event.data);
                }
            };

            // Capture de l'image de la vidéo et détection du QR code
            function captureFrame() {
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                qrWorker.postMessage(imageData);
                requestAnimationFrame(captureFrame);
            }

            // Démarrer la capture d'images
            requestAnimationFrame(captureFrame);
        }

        // Charger la bibliothèque jsQR
        const jsQRScript = document.createElement('script');
        jsQRScript.src = 'jsQR.js'; // Remplacez 'jsQR.js' par le chemin de votre fichier jsQR
        jsQRScript.onload = initQRCodeScanner;
        document.head.appendChild(jsQRScript);
    </script>
</body>
</html>
