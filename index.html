<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Emargemetn JPO</title>
  </head>
  
  <body class="cont">
    
    <h3 class="txt-cntr mar-top-2">JPO du 09/12/23</h3>

    <article class="pad-2">
        <section>
            <div class="frm-grp txt-cntr">
				<label class="disp-blck">Choose camera:</label>
				<select id="webcameraChanger" onchange="cameraChange($(this).val());" class="frm-ctrl mar-btm-2"></select>
			</div>
            <!-- webcamera view component -->
            <video id="webcameraPreview" playsinline autoplay controls muted loop style="width: 100%;"></video>
        </section>
    </article>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="../../external/adapter.min.js"></script>
    <script type="text/javascript" src="../../external/instascan.js"></script>
    <script type="text/javascript" src="../../src/QrCodeScanner.js"></script>
    <script type="text/javascript">
        // Configurations de l'API Google Sheets
        const apiKey = "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";
        const clientId = "549585339883-3p01j2inukmo7nrg9tnpdglisg1splrf.apps.googleusercontent.com";
        const spreadsheetId = "1gvvhXBmO_0rPJvCNYiO9yXBgd2PRjNTw1PKlwE-3dqQ";
        const colonneEmail = "G"; // Colonne contenant les adresses e-mail
        const colonneCheckbox = "I"; // Colonne pour les cases à cocher

        // Composant vidéo HTML pour la caméra Web
        var videoComponent = $("#webcameraPreview");
        // Composant de sélection HTML pour le changement de caméras
        var webcameraChanger = $("#webcameraChanger");
        var options = {};
        // Initialiser les options du scanner vidéo
        options = initVideoObjectOptions("webcameraPreview");
        var cameraId = 0;

        initScanner(options);

        initAvaliableCameras(
            webcameraChanger,
            function () {
                cameraId = parseInt(getSelectedCamera(webcameraChanger));
            }
        );

        initCamera(cameraId);

        scanStart(function (data) {
            // Supposons que les données scannées sont l'adresse e-mail
            const scannedEmail = data;
            
            // Mettre à jour la case à cocher dans Google Sheets
            updateCheckbox(scannedEmail);
	    alert(data);
        });

        function updateCheckbox(email) {
            // Utiliser l'API Google Sheets pour mettre à jour la case à cocher
            // Vous devez implémenter les appels réels à l'API Google Sheets en fonction de la documentation : https://developers.google.com/sheets/api

            // Exemple de code (en utilisant jQuery.ajax) :
            $.ajax({
                url: `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values:batchUpdate`,
                type: "POST",
                headers: {
                    "Authorization": `Bearer ${apiKey}`,
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({
                    requests: [
                        {
                            updateCells: {
                                rows: [
                                    {
                                        values: [
                                            {
                                                userEnteredValue: {
                                                    boolValue: true
                                                }
                                            }
                                        ]
                                    }
                                ],
                                fields: "userEnteredValue.boolValue",
                                range: `${colonneCheckbox}1:${colonneCheckbox}1`
                            }
                        }
                    ]
                }),
                success: function(response) {
                    console.log("Case à cocher mise à jour avec succès");
                    alert("Merci");
                },
                error: function(error) {
                    console.error("Erreur lors de la mise à jour de la case à cocher :", error);
                }
            });
        }
    </script>

  </body>
</html>
