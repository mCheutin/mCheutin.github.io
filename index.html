<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Emargement JPO</title>
  </head>
  
  <body class="cont">
    <h3 class="txt-cntr mar-top-2">JPO du 09/12/23</h3>

    <article class="pad-2">
        <section>
            <div class="frm-grp txt-cntr">
                <label class="disp-blck">Choose camera:</label>
                <select id="webcameraChanger" onchange="cameraChange($(this).val());" class="frm-ctrl mar-btm-2"></select>
            </div>
            <video id="webcameraPreview" playsinline autoplay controls muted loop style="width: 100%;"></video>
        </section>
    </article>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script type="text/javascript" src="../../external/adapter.min.js"></script>
    <script type="text/javascript" src="../../external/instascan.js"></script>
    <script type="text/javascript" src="../../src/QrCodeScanner.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        var videoComponent = $("#webcameraPreview");
        var webcameraChanger = $("#webcameraChanger");
        var options = {};
        options = initVideoObjectOptions("webcameraPreview");
        var cameraId = 0;

        initScanner(options);

        initAvaliableCameras(
            webcameraChanger,
            function () {
                cameraId = parseInt(getSelectedCamera(webcameraChanger));
            }
        );

        initCamera(cameraId);

        scanStart(function (data){
            appendDataToSheet(data);
        });

        function appendDataToSheet(email) {
            console.log('Tentative d\'ajout de données à la feuille de calcul...');

            var spreadsheetId = '1gvvhXBmO_0rPJvCNYiO9yXBgd2PRjNTw1PKlwE-3dqQ';
            var range = 'enregistrement';
            var apiKey = 'AIzaSyDuSVZIxItzg1u85BS2LPyFo9ovSXQ54pw';  // Remplacez par votre clé API Google Sheets

            var url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}:append`;
            var values = [[email]];

            var params = {
                values: values,
                majorDimension: 'ROWS',
            };

            axios.post(url, params, {
                params: {
                    key: apiKey,
                    valueInputOption: 'RAW',
                },
            })
            .then(function (response) {
                console.log('Données ajoutées avec succès :', response.data);
            })
            .catch(function (error) {
                console.error('Erreur lors de l\'ajout des données :', error.response.data);
            });
        }
    </script>
  </body>
</html>
